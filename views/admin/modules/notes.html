<!-- views/admin/modules/notes.html -->
<div class="module-manage-notes">
  <div class="d-flex align-items-center justify-content-between mb-3">
    <h4 class="mb-0"><i class="bi bi-journal-text"></i> Manage Notes</h4>
  </div>

  <!-- KPI Row -->
  <div class="row mb-3" id="kpiRow">
    <div class="col-md-3">
      <div class="kpi-card border bg-sky">
        <i class="bi bi-journal-text"></i>
        <div class="kpi-label">Total Notes</div>
        <div class="kpi-value" id="kpiTotal">—</div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="kpi-card border bg-green">
        <i class="bi bi-heart"></i>
        <div class="kpi-label">Most Liked</div>
        <div class="kpi-value" id="kpiMostLiked">—</div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="kpi-card border bg-sky">
        <i class="bi bi-download"></i>
        <div class="kpi-label">Most Downloaded</div>
        <div class="kpi-value" id="kpiMostDownloaded">—</div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="kpi-card border bg-purple">
        <i class="bi bi-flag"></i>
        <div class="kpi-label">Most Reported</div>
        <div class="kpi-value" id="kpiMostReported">—</div>
      </div>
    </div>
  </div>

  <!-- Filters -->
  <div class="card card-ghost mb-3 p-3">
    <div class="row g-2 align-items-center">
      <div class="col-md-2">
        <div class="input-group">
          <span class="input-group-text"><i class="bi bi-search"></i></span>
          <input id="filterKeyword" class="form-control" placeholder="Search title or keyword">
        </div>
      </div>
      <div class="col-md-2">
        <div class="input-group">
          <span class="input-group-text"><i class="bi bi-person"></i></span>
          <input id="filterUploader" class="form-control" placeholder="Uploader name or email">
        </div>
      </div>
      <div class="col-md-2">
        <div class="input-group">
          <span class="input-group-text"><i class="bi bi-book"></i></span>
          <select id="filterSubject" class="form-select">
            <option value="">All Subjects</option>
          </select>
        </div>
      </div>
      <div class="col-md-2">
        <div class="input-group">
          <span class="input-group-text"><i class="bi bi-tags"></i></span>
          <input id="filterTags" class="form-control" placeholder="Tags (comma separated)">
        </div>
      </div>
      <div class="col-md-2">
        <div class="input-group">
          <span class="input-group-text"><i class="bi bi-calendar-date"></i></span>
          <input id="filterDate" type="month" class="form-control">
        </div>
      </div>
      <div class="col-md-2">
        <button id="filterBtn" class="btn btn-primary w-100">
          <i class="bi bi-search"></i> Search
        </button>
      </div>
    </div>
  </div>

  <!-- Table -->
  <div class="card card-ghost p-3">
    <div class="table-responsive">
      <table class="table table-hover align-middle" id="notesTable">
        <thead>
        <tr>
          <th>#</th>
          <th class="sortable" onclick="sortNotesTable('id', this)">Note ID <i class="bi bi-arrow-down-up"></i></th>
          <th class="sortable" onclick="sortNotesTable('title', this)">Title <i class="bi bi-arrow-down-up"></i></th>
          <th class="sortable" onclick="sortNotesTable('uploader', this)">Uploader <i class="bi bi-arrow-down-up"></i></th>
          <th class="sortable" onclick="sortNotesTable('subject', this)">Subject <i class="bi bi-arrow-down-up"></i></th>
          <th class="sortable text-center" onclick="sortNotesTable('likes', this)"><i class="bi bi-heart"></i></th>
          <th class="sortable text-center" onclick="sortNotesTable('reports', this)"><i class="bi bi-flag"></i></th>
          <th class="sortable text-center" onclick="sortNotesTable('downloads', this)"><i class="bi bi-download"></i></th>

          <th class="text-center">Actions</th>
        </tr>
      </thead>

        <tbody id="notesTableBody"></tbody>
      </table>
    </div>
    <nav><ul class="pagination mt-2" id="notesPagination"></ul></nav>
  </div>
</div>

<!-- Combined View/Edit Modal (modern 4-column form) -->
<div class="modal fade" id="noteDetailModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <form id="noteDetailForm" class="modal-content" enctype="multipart/form-data" novalidate>
      <div class="modal-header">
        <h5 id="noteDetailTitle" class="modal-title">Note Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body">
        <!-- form grid (4 columns on md+) -->
        <div id="noteFormContainer" class="container-fluid">
          <div class="row g-3">

            <!-- Column 1 -->
            <div class="col-12 col-md-3">
              <label class="form-label small">Note ID</label>
              <input class="form-control boxed-field" name="_id" id="fld_id" readonly>
            </div>

            <div class="col-12 col-md-3">
              <label class="form-label small">Uploader Name</label>
              <input class="form-control boxed-field" name="uploaderName" id="fld_uploaderName" readonly>
            </div>

            <div class="col-12 col-md-3">
              <label class="form-label small">Uploader ID</label>
              <input class="form-control boxed-field" name="uploaderId" id="fld_uploaderId" readonly>
            </div>

            <div class="col-12 col-md-3">
              <label class="form-label small">Upload Date</label>
              <input class="form-control boxed-field" name="uploadDate" id="fld_uploadDate" readonly>
            </div>

            <!-- Column 2 -->
            <div class="col-12 col-md-3">
              <label class="form-label small">Title</label>
              <input class="form-control boxed-field" name="title" id="fld_title" required>
            </div>

            <div class="col-12 col-md-3">
              <label class="form-label small">Subject</label>
             <select class="form-select boxed-field" name="subject" id="fld_subject">
              <option value="">-- Select Subject --</option>
            </select>

            </div>

            <div class="col-12 col-md-3">
              <label class="form-label small">Visibility</label>
              <select class="form-select boxed-field" name="visibility" id="fld_visibility">
                <option value="public">public</option>
                <option value="private">private</option>
              </select>
            </div>

            <div class="col-12 col-md-3">
              <label class="form-label small">Tags (comma separated)</label>
              <input class="form-control boxed-field" name="tags" id="fld_tags" placeholder="tag1,tag2">
            </div>

            <!-- Column 3 -->
            <div class="col-12 col-md-3">
              <label class="form-label small">Likes</label>
              <input class="form-control boxed-field" name="likesCount" id="fld_likes" readonly>
            </div>

            <div class="col-12 col-md-3">
              <label class="form-label small">Downloads</label>
              <input class="form-control boxed-field" name="downloads" id="fld_downloads" readonly>
            </div>

            <div class="col-12 col-md-3">
              <label class="form-label small">Reports</label>
              <input class="form-control boxed-field" name="reportsCount" id="fld_reports" readonly>
            </div>

            <div class="col-12 col-md-3">
              <label class="form-label small">Original Filename</label>
              <input class="form-control boxed-field" name="fileOriginalName" id="fld_fileOriginalName" readonly>
            </div>

            <!-- Column 4: description full width on small, partial on md -->
            <div class="col-12 col-md-12">
              <label class="form-label small">Description</label>
              <textarea class="form-control boxed-field" name="description" id="fld_description" rows="3"></textarea>
            </div>

            <!-- File replacement row -->
            <div class="col-12 col-md-12">
              <label class="form-label small">Replace File (optional)</label>
              <input type="file" class="form-control" name="file" id="fld_file">
              <div class="form-text small text-muted" id="fld_currentFileText"></div>
            </div>

            <!-- Preview -->
            <div class="col-12 col-md-12">
              <label class="form-label small">Preview</label>
              <div id="adminPreview" class="border rounded p-2" style="min-height:84px"></div>
            </div>

          </div> <!-- row -->
        </div> <!-- noteFormContainer -->
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <!-- Save visible only in edit mode; toggled by JS -->
        <button id="saveEditBtn" type="submit" class="btn btn-primary d-none">Save Changes</button>
      </div>
    </form>
  </div>
</div>

<!-- small inline CSS to make readonly inputs look boxed -->
<style>
  .boxed-field[readonly] {
    background-color: #f8f9fa;
    box-shadow: none;
  }
  .boxed-field {
    border-radius: 6px;
  }
  /* preview area scroll on small content */
  #adminPreview img, #adminPreview iframe { max-width:100%; display:block; }
</style>

<!-- Delete Confirmation -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1">
  <div class="modal-dialog modal-md modal-top">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h6 class="modal-title mb-0">
          <i class="bi bi-trash3 me-1"></i> Confirm Delete
        </h6>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <p class="mb-0">
          Are you sure you want to delete <strong id="deleteNoteTitle">this note</strong>?
        </p>

      </div>
      <div class="modal-footer justify-content-end">
        <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">Cancel</button>
        <button id="confirmDeleteBtn" class="btn btn-danger">Delete</button>
      </div>
    </div>
  </div>
</div>

<link rel="stylesheet" href="/admin/css/notes.css">
