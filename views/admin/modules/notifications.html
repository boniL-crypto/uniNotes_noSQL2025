<!-- views/admin/modules/notifications.html -->
<section class="admin-notifications page-container">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h4 class="mb-0"><i class="bi bi-bell"></i> Notifications</h4>
  </div>

  <!-- Send new -->
  <div class="card mb-3">
    <div class="card-header bg-light"><i class="bi bi-pencil-square"></i> Send New Notification</div>
    <div class="card-body">
      <form id="notifyForm" class="mb-3">
        <div class="row g-3 mb-3">
          <div class="col-md-4">
            <label class="form-label">Recipient Type</label>
            <select id="recipientType" class="form-select">
              <option value="all">All Students</option>
              <option value="user">Specific User(s)</option>
              <option value="course">By Course</option>
            </select>
          </div>

          <div class="col-md-4" id="courseField" style="display:none; position: relative;">
  <label class="form-label">Course</label>
  <input id="recipientCourseInput" type="text" class="form-control" placeholder="Type or select a course" autocomplete="off">
  <ul id="courseDropdown" class="list-group position-absolute w-100 shadow-sm" 
      style="z-index:1000; max-height:200px; overflow:auto; display:none;"></ul>
</div>

          <div class="col-md-4" id="userField" style="display:none;">
            <label class="form-label">Users</label><br>
            <button type="button" class="btn btn-outline-primary btn-sm" id="selectUsersBtn">
              <i class="bi bi-people-fill"></i> Select Recipients
            </button>
            <div id="selectedUsersPreview" class="small text-muted mt-1">No users selected.</div>
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label">Message</label>
          <textarea id="messageText" class="form-control" rows="3" placeholder="Write your notification..."></textarea>
        </div>

        <div class="text-end">
          <button type="submit" class="btn btn-primary"><i class="bi bi-send-fill"></i> Send</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Tabs -->
  <ul class="nav nav-tabs mb-3" id="notifTabs">
    <li class="nav-item">
      <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#incomingPanel">
        <i class="bi bi-inbox"></i> Incoming
      </button>
    </li>
    <li class="nav-item">
      <button class="nav-link" data-bs-toggle="tab" data-bs-target="#outgoingPanel">
        <i class="bi bi-send"></i> Outgoing
      </button>
    </li>
  </ul>

  <div class="tab-content">
    <!-- INCOMING -->
    <div class="tab-pane fade show active" id="incomingPanel">
      <div class="card">
        <div class="card-header bg-light d-flex justify-content-between align-items-center">
          <span><i class="bi bi-megaphone-fill text-primary"></i> Incoming</span>
          <div>
            <button id="refreshIncomingBtn" class="btn btn-sm btn-outline-secondary">
              <i class="bi bi-arrow-clockwise"></i> Refresh
            </button>
            <div class="btn-group ms-2" role="group" aria-label="incoming-actions">
              <div class="form-check form-check-inline mb-0 align-middle me-2">
                <input class="form-check-input" type="checkbox" id="selectAllIncoming">
                <label class="form-check-label small" for="selectAllIncoming">Select All</label>
              </div>
              <button id="deleteSelectedIncoming" class="btn btn-sm btn-outline-danger">
                <i class="bi bi-trash"></i> Delete Selected
              </button>
            </div>
          </div>
        </div>

        <div class="card-body p-0">
          <ul id="incomingList" class="list-group list-group-flush">
            <li class="list-group-item text-center text-muted">Loading...</li>
          </ul>
        </div>

        <div class="card-footer d-flex justify-content-between align-items-center">
          <div class="small text-muted">Showing recent notifications</div>
          <ul id="incomingPagination" class="pagination pagination-sm mb-0"></ul>
        </div>
      </div>
    </div>

    <!-- OUTGOING -->
    <div class="tab-pane fade" id="outgoingPanel">
      <div class="card mb-3">
        <div class="card-header bg-light d-flex justify-content-between align-items-center">
          <span><i class="bi bi-clock-history"></i> Sent Notifications</span>
          <div>
            <button id="refreshOutgoingBtn" class="btn btn-sm btn-outline-secondary">
              <i class="bi bi-arrow-clockwise"></i> Refresh
            </button>
            <div class="btn-group ms-2" role="group" aria-label="outgoing-actions">
              <div class="form-check form-check-inline mb-0 align-middle me-2">
                <input class="form-check-input" type="checkbox" id="selectAllOutgoing">
                <label class="form-check-label small" for="selectAllOutgoing">Select All</label>
              </div>
              <button id="deleteSelectedOutgoing" class="btn btn-sm btn-outline-danger">
                <i class="bi bi-trash"></i> Delete Selected
              </button>
            </div>
          </div>
        </div>

        <div class="card-body p-0">
          <ul id="outgoingList" class="list-group list-group-flush">
            <li class="list-group-item text-center text-muted">Loading...</li>
          </ul>
        </div>

        <div class="card-footer d-flex justify-content-between align-items-center">
          <div class="small text-muted">Showing recent sent messages</div>
          <ul id="outgoingPagination" class="pagination pagination-sm mb-0"></ul>
        </div>
      </div>
    </div>
  </div>

  <!-- user selection modal -->
  <div class="modal fade" id="userSelectModal" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header bg-light">
          <h5 class="modal-title"><i class="bi bi-people"></i> Select Users</h5>
          <button class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="input-group mb-2">
            <span class="input-group-text"><i class="bi bi-search"></i></span>
            <input id="userSearchInput" type="text" class="form-control" placeholder="Search by name/email">
          </div>
          <ul id="userListContainer" class="list-group list-group-flush" style="max-height:400px; overflow:auto;">
            <li class="list-group-item text-center text-muted">Loading...</li>
          </ul>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button class="btn btn-primary" id="confirmUserSelectionBtn">Confirm Selection</button>
        </div>
      </div>
    </div>
  </div>

</section>

<!-- Add small CSS (put in your admin stylesheet or keep inline here) -->
<style>
  .notif-row { display:flex; align-items:center; gap:12px; }
  .notif-message { flex:1;  white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
  .notif-meta { white-space:nowrap; text-align:right; min-width:160px; color:#6c757d; font-size:.85rem; }
  .list-group-item { border-color: #e9ecef; }
   #courseDropdown {
    text-align: left;
    padding-left: 0;
    max-height: 220px;       /* scrollable if many courses */
    overflow-y: auto;
    min-width: 500px;
  }

  #courseDropdown .list-group-item {
    display: flex;           /* make it two-column layout */
    align-items: center;
    gap: 12px;
    text-align: left;
    padding: 6px 12px;
    font-size: 0.9rem;
    cursor: pointer;
    border: none;
  }

  #courseDropdown .list-group-item strong {
    width: 90px;             /* fixed width column for codes */
    flex-shrink: 0;
  }

  #courseDropdown .list-group-item span.course-name {
    flex: 1;
    white-space: nowrap;     /* keeps all names in one line */
    overflow: hidden;
    text-overflow: ellipsis; /* truncates very long names */
  }

  #courseDropdown .list-group-item:hover {
    background-color: #f8f9fa;
  }
</style>
