<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Reset Password â€¢ Uni Notes</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <style>
    :root { --brand: #4e73df; --brand-2: #1cc88a; }
    html, body { height: 100%; }
    body {
      font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(135deg, #4e73df, #1cc88a);
      min-height: 100vh;
      display: flex; align-items: center; justify-content: center;
      padding: 24px;
    }

    /* --- Brand Header --- */
    .brand {
      display: flex; align-items: center; justify-content: flex-start;
      gap: 12px; margin-bottom: 18px;
    }
    .brand .logo {
      width: 44px; height: 44px; border-radius: 10px;
      display: grid; place-items: center; font-weight: 800; color: #fff;
      background: linear-gradient(135deg, #60a5fa, #3b82f6);
      box-shadow: 0 8px 20px rgba(31,99,221,.25);
      letter-spacing: .5px;
    }
    .brand .text .title {
      font-weight: 800; font-size: 0.95rem; color: #1f2937;
    }
    .brand .text .subtitle {
      font-size: 0.75rem; color: #6b7280;
    }

    /* --- Card --- */
    .auth-card {
      width: 100%; max-width: 420px;
      background: #fff;
      border-radius: 1rem;
      box-shadow: 0 8px 22px rgba(0,0,0,.15);
      padding: 22px 22px 12px;
      position: relative;
    }

    /* --- Text Sizes Adjusted --- */
    .auth-card h4 {
      color: #111827;
      font-weight: 800;
      font-size: 1.1rem;
    }
    .auth-card p.helper {
      color: #6b7280;
      font-size: 0.85rem;
      margin-top: -4px;
    }

    /* --- Input --- */
    .form-control {
      background: #fff;
      border: 1px solid #d1d5db;
      color: #111827;
      font-size: 0.9rem;
    }
    .form-control:focus {
      border-color: #60a5fa;
      box-shadow: 0 0 0 .2rem rgba(96,165,250,.25);
    }
    .input-icon {
      position: relative;
    }
    .toggle-pass {
      position: absolute;
      right: 10px; top: 50%;
      transform: translateY(-50%);
      color: #6b7280;
      cursor: pointer;
      z-index: 2;
      width: 28px; height: 28px;
      display: grid; place-items: center;
      border-radius: 6px;
      background: transparent;
      pointer-events: auto; user-select: none;
    }
    .toggle-pass:hover { background: #f3f4f6; }

    /* --- Button --- */
    .btn-brand {
      background: linear-gradient(90deg,#2563eb,#3b82f6);
      border: none;
      color: #fff;
      font-weight: 700;
      font-size: 0.95rem;
      box-shadow: 0 8px 22px rgba(59,130,246,.25);
    }
    .btn-brand:hover { filter: brightness(1.05); }

    /* --- Back to Login link --- */
    .back-login {
      display: block;
      text-align: right;
      font-size: 0.85rem;
      margin-top: 6px;
    }
    .back-login a {
      color: #2563eb;
      text-decoration: none;
      font-weight: 600;
    }
    .back-login a:hover {
      text-decoration: underline;
    }

    #msg { min-height: 24px; }
  </style>
</head>
<body>
  <!-- Floating Toast -->
  <div class="position-fixed top-0 start-50 translate-middle-x p-3" style="z-index: 1080;">
    <div id="toastBox" class="toast align-items-center text-white border-0" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="d-flex">
        <div id="toastMsg" class="toast-body"></div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
      </div>
    </div>
  </div>

  <div class="auth-card">
    <div class="brand">
      <div class="logo">UN</div>
      <div class="text">
        <div class="title">Uni Notes</div>
        <div class="subtitle">Reset your password</div>
      </div>
    </div>

    <h4 class="mb-2">Create a new password</h4>
    <p class="helper mb-3">Choose a strong password you haven't used before.</p>

    <form id="resetForm" class="mt-2">
      <div class="mb-3 input-icon">
        <input type="password" id="password" class="form-control" placeholder="New password" required minlength="6" autocomplete="new-password" />
        <i id="togglePass" class="bi bi-eye-slash toggle-pass" title="Show/Hide"></i>
      </div>
      <button class="btn btn-brand w-100" type="submit">
        <i class="bi bi-arrow-repeat me-1"></i> Change Password
      </button>
    </form>

    <!-- Back to login link -->
    <div class="back-login">
      <a href="/login.html"><i class="bi bi-box-arrow-in-left me-1"></i>Login</a>
    </div>

    <div id="msg" class="mt-3 text-center"></div>
  </div>

  <!-- Bootstrap Bundle for toast -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const token = urlParams.get('token');

    const passInput = document.getElementById('password');
    const toggle = document.getElementById('togglePass');
    if (toggle) {
      toggle.addEventListener('click', () => {
        const isPw = passInput.getAttribute('type') === 'password';
        passInput.setAttribute('type', isPw ? 'text' : 'password');
        toggle.classList.toggle('bi-eye-slash', !isPw);
        toggle.classList.toggle('bi-eye', isPw);
      });
    }

    const toastBox = document.getElementById('toastBox');
    const toastMsg = document.getElementById('toastMsg');
    const toast = new bootstrap.Toast(toastBox, { delay: 3000 });
    function showToast(message, type = 'info') {
      toastBox.className = 'toast align-items-center text-white border-0';
      if (type === 'success') toastBox.classList.add('bg-success');
      else if (type === 'error' || type === 'danger') toastBox.classList.add('bg-danger');
      else if (type === 'warning') { toastBox.classList.add('bg-warning', 'text-dark'); }
      else toastBox.classList.add('bg-info');
      toastMsg.textContent = message;
      toast.show();
    }

    document.getElementById('resetForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      showToast('Resetting...', 'info');

      try {
        const res = await fetch('/api/auth/reset-password', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ token, newPassword: passInput.value })
        });
        const data = await res.json().catch(() => ({ message: 'Unexpected response' }));
        if (res.ok) {
          showToast(data.message || 'Password updated.', 'success');
          setTimeout(() => (window.location.href = '/login.html'), 1500);
        } else {
          showToast(data.message || 'Invalid or expired token.', 'error');
        }
      } catch (err) {
        showToast('Network error. Please try again.', 'error');
      }
    });
  </script>
</body>
</html>
